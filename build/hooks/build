#!/usr/bin/env bash

if [[ -v DOCKER_TAG ]]; then
  if [[ "5.5 5.6 7.0 7.1 7.2" == *"$DOCKER_TAG"* ]]; then
    PHP_VERSIONS=$DOCKER_TAG
  fi
fi

for php_version in $PHP_VERSIONS; do
  xdebug_version=
  if [ "$php_version" == "5.5" ] || [ "$php_version" == "5.6" ]; then
    xdebug_version=-2.5.5
  fi;
  for php_variant in $PHP_VARIANTS; do
    image_name=jestefane/php-dev:$php_version-$php_variant-$SOURCE_BRANCH
    echo Building image: "$image_name"
    docker build \
      -t "$image_name" \
      --build-arg BUILD_PHP_VERSION="$php_version" \
      --build-arg BUILD_PHP_VARIANT="$php_variant" \
      --build-arg BUILD_XDEBUG_VERSION="$xdebug_version" .
  done
done
