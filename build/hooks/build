#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

# shellcheck source=./_common
. "$DIR/_common"

for php_version in $PHP_VERSIONS; do
  xdebug_version=
  if [ "$php_version" == "5.5" ] || [ "$php_version" == "5.6" ]; then
    echo "Using XDebug version $xdebug_version"
    xdebug_version=-2.5.5
  fi;
  for php_variant in $PHP_VARIANTS; do
    image_name="$DOCKER_REPO:$php_version-$php_variant-$SOURCE_BRANCH"
    echo "Building image: $image_name"
    docker build \
      -t "$image_name" \
      --build-arg BUILD_PHP_VERSION="$php_version" \
      --build-arg BUILD_PHP_VARIANT="$php_variant" \
      --build-arg BUILD_XDEBUG_VERSION="$xdebug_version" "$DIR/.."
  done
done

exit 0
