#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

# shellcheck source=./_common
. "$DIR/_common"

for php_version in $PHP_VERSIONS; do
  for php_variant in $PHP_VARIANTS; do
    image_name="$DOCKER_REPO:$php_version-$php_variant-$SOURCE_BRANCH"
    echo Pushing tag: "$image_name"
    docker push "$image_name"
  done
done

tag=${DOCKER_TAG##*-}
if [ "$PHP_VERSIONS" == "7.2" ] && [ "$PHP_VARIANTS" == "cli" ] && [ "$tag" == "latest" ]; then
  docker tag "$DOCKER_REPO:$PHP_VERSIONS-$PHP_VARIANTS-$SOURCE_BRANCH" "$DOCKER_REPO:$tag"
  docker push "$DOCKER_REPO:$tag"
fi

exit 0
